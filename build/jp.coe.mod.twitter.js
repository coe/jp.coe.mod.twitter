var exports=exports||this;function compVersions(l,j){for(var f=0,i=l.split("."),e=j.split("."),a=Math.max(i.length,e.length),b=0;b<a;b++){var c=b<i.length?parseInt(i[b],10):0,d=b<e.length?parseInt(e[b],10):0;isNaN(c)&&(c=0);isNaN(d)&&(d=0);if(c!=d){f=c>d?1:-1;break}}return f}
exports.Twitter=function(){function l(){var a=this,b=this.oauthClient,c=Ti.UI.createWindow({title:this.windowTitle}),d=Ti.UI.createWebView(),e=Ti.UI.createView({backgroundColor:"black",opacity:0.7,zIndex:1}),g=Titanium.UI.createActivityIndicator({height:50,width:10,message:"Loading...",color:"white"}),k=Ti.UI.createButton({title:this.windowClose}),m=Ti.UI.createButton({title:this.windowBack}),h=null;this.webView=d;c.leftNavButton=k;g.show();e.add(g);c.add(e);Ti.API.debug("tiver:"+Titanium.version);
null!=Ti.UI.iOS&&0<=compVersions(Titanium.version,"3.1.3")?(h=Ti.UI.iOS.createNavigationWindow({modal:!0,window:c}),h.open()):c.open({modal:!0});c.add(d);k.addEventListener("click",function(){null!=h&&h.close();c.close();a.fireEvent("cancel",{success:!1,error:"The user cancelled.",result:null})});m.addEventListener("click",function(){d.goBack()});d.addEventListener("beforeload",function(){f||c.add(e);g.show()});d.addEventListener("load",function(d){console.log("twittermod load");-1===d.url.indexOf(a.authorizeUrl)?
(console.log("twittermod load1"),c.remove(e),g.hide(),c.leftNavButton!==m&&(c.leftNavButton=m)):(console.log("twittermod load2"),c.leftNavButton!==k&&(c.leftNavButton=k),d=d.source.evalJS("document.getElementById('oauth_pin').getElementsByTagName('code')[0].innerText"),console.log("twittermod pin:"+d),d?(console.log("twittermod load22"),f||(null!=h&&h.close(),c.close()),b.accessTokenUrl="https://api.twitter.com/oauth/access_token?oauth_verifier="+d,b.fetchAccessToken(function(){console.log("twittermod load3");
a.fireEvent("login",{success:!0,error:!1,accessTokenKey:b.getAccessTokenKey(),accessTokenSecret:b.getAccessTokenSecret()});a.authorized=!0;f&&(null!=h&&h.close(),c.close())},function(b){console.log("twittermod load4");a.fireEvent("login",{success:!1,error:"Failure to fetch access token, please try again.",result:b})})):(console.log("twittermod load21"),c.remove(e),g.hide()))})}var j=function(){},f="android"===Ti.Platform.osname,i=require("jp.coe.mod.jsOAuth-1.3.3"),e=function(a){var b;b=this instanceof
e?this:new j;a||(a={});b.windowTitle=a.windowTitle||"Twitter Authorization";b.windowClose=a.windowClose||"Close";b.windowBack=a.windowBack||"Back";b.consumerKey=a.consumerKey;b.consumerSecret=a.consumerSecret;b.authorizeUrl="https://api.twitter.com/oauth/authorize";b.accessTokenKey=a.accessTokenKey;b.accessTokenSecret=a.accessTokenSecret;b.authorized=!1;b.listeners={};b.accessTokenKey&&b.accessTokenSecret&&(b.authorized=!0);a.requestTokenUrl=a.requestTokenUrl||"https://api.twitter.com/oauth/request_token";
b.oauthClient=i.OAuth(a);return b};j.prototype=e.prototype;e.prototype.authorize=function(){var a=this;this.authorized?setTimeout(function(){a.fireEvent("login",{success:!0,error:!1,accessTokenKey:a.accessTokenKey,accessTokenSecret:a.accessTokenSecret})},1):(l.call(this),this.oauthClient.fetchRequestToken(function(b){a.webView.url=a.authorizeUrl+b},function(b){a.fireEvent("login",{success:!1,error:"Failure to fetch access token, please try again.",result:b})}))};e.prototype.request=function(a,b,c,
d,e){var g=this,f=this.oauthClient,a=a.match(/^https?:\/\/.+/i)?a:"https://api.twitter.com/"+a;f.request({method:d,url:a,data:b,headers:c,success:function(a){e.call(g,{success:!0,error:!1,result:a})},failure:function(a){e.call(g,{success:!1,error:"Request failed",result:a})}})};e.prototype.logout=function(a){this.oauthClient.setAccessToken("","");this.accessTokenSecret=this.accessTokenKey=null;this.authorized=!1;a()};e.prototype.isAuthorized=function(){return this.authorized};e.prototype.addEventListener=
function(a,b){this.listeners=this.listeners||{};this.listeners[a]=this.listeners[a]||[];this.listeners[a].push(b)};e.prototype.fireEvent=function(a,b){for(var c=this.listeners[a]||[],d=0;d<c.length;d++)c[d].call(this,b)};return e}(this);
var exports=exports||this;function compVersions(g,h){for(var c=0,a=g.split("."),b=h.split("."),i=Math.max(a.length,b.length),d=0;d<i;d++){var e=d<a.length?parseInt(a[d],10):0,f=d<b.length?parseInt(b[d],10):0;isNaN(e)&&(e=0);isNaN(f)&&(f=0);if(e!=f){c=e>f?1:-1;break}}return c}
exports.Twitter=function(){var g=function(){},h=require("jp.coe.mod.jsOAuth-1.3.3");Ti.App.addEventListener("resumed",function(a){var b=OS_IOS?Ti.App.getArguments():a&&a.args;if(b&&b.url&&(a=b.url.split("?")[0],b=b.url.split("?")[1]))b=OAuth.decodeForm(b),"snsnet://twitter"===a?(a=new OAuth({consumerKey:Alloy.CFG.twitterConsumerKey,consumerSecret:Alloy.CFG.twitterConsumerSecret}),a.post("https://api.twitter.com/oauth/access_token",b,function(){})):"snsnet://facebook"===a&&(a=Alloy.Globals.RestClient.addToURL("https://graph.facebook.com/oauth/access_token",
_.extend(OAuth.getParameterMap(b),{client_id:Alloy.CFG.facebookConsumerKey,client_secret:Alloy.CFG.facebookConsumerSecret,redirect_uri:Alloy.CFG.facebookCallbackURL})),Alloy.Globals.RestClient.get(a,function(){}))});Ti.Android.currentActivity.addEventListener("app:resume",function(a){Ti.API.debug("***** app:resume:");Ti.App.fireEvent("resumed",{args:{url:a.data}})});var c=function(a){var b;b=this instanceof c?this:new g;a||(a={});b.windowTitle=a.windowTitle||"Twitter Authorization";b.windowClose=
a.windowClose||"Close";b.windowBack=a.windowBack||"Back";b.consumerKey=a.consumerKey;b.consumerSecret=a.consumerSecret;b.authorizeUrl="https://api.twitter.com/oauth/authorize";b.accessTokenKey=a.accessTokenKey;b.accessTokenSecret=a.accessTokenSecret;b.authorized=!1;b.listeners={};b.accessTokenKey&&b.accessTokenSecret&&(b.authorized=!0);a.requestTokenUrl=a.requestTokenUrl||"https://api.twitter.com/oauth/request_token";b.oauth_callback=a.urlScheme;b.oauthClient=h.OAuth(a);return b};g.prototype=c.prototype;
c.prototype.authorize=function(){var a=this;this.authorized?setTimeout(function(){a.fireEvent("login",{success:!0,error:!1,accessTokenKey:a.accessTokenKey,accessTokenSecret:a.accessTokenSecret})},1):this.oauthClient.fetchRequestToken(function(b){Ti.Platform.openURL(a.authorizeUrl+b)},function(b){a.fireEvent("login",{success:!1,error:"Failure to fetch access token, please try again.",result:b})})};c.prototype.request=function(a,b,c,d,e){var f=this,g=this.oauthClient,a=a.match(/^https?:\/\/.+/i)?a:
"https://api.twitter.com/"+a;g.request({method:d,url:a,data:b,headers:c,success:function(a){e.call(f,{success:!0,error:!1,result:a})},failure:function(a){e.call(f,{success:!1,error:"Request failed",result:a})}})};c.prototype.logout=function(a){this.oauthClient.setAccessToken("","");this.accessTokenSecret=this.accessTokenKey=null;this.authorized=!1;a()};c.prototype.isAuthorized=function(){return this.authorized};c.prototype.addEventListener=function(a,b){this.listeners=this.listeners||{};this.listeners[a]=
this.listeners[a]||[];this.listeners[a].push(b)};c.prototype.fireEvent=function(a,b){for(var c=this.listeners[a]||[],d=0;d<c.length;d++)c[d].call(this,b)};return c}(this);
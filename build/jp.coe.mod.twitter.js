var exports=exports||this;function compVersions(l,j){for(var f=0,i=l.split("."),c=j.split("."),a=Math.max(i.length,c.length),b=0;b<a;b++){var d=b<i.length?parseInt(i[b],10):0,e=b<c.length?parseInt(c[b],10):0;isNaN(d)&&(d=0);isNaN(e)&&(e=0);if(d!=e){f=d>e?1:-1;break}}return f}
exports.Twitter=function(){function l(){var a=this,b=this.oauthClient,d=Ti.UI.createWindow({title:this.windowTitle}),e=Ti.UI.createWebView(),c=Ti.UI.createView({backgroundColor:"black",opacity:0.7,zIndex:1}),g=Titanium.UI.createActivityIndicator({height:50,width:10,message:"Loading...",color:"white"}),k=Ti.UI.createButton({title:this.windowClose}),m=Ti.UI.createButton({title:this.windowBack}),h=null;this.webView=e;d.leftNavButton=k;g.show();c.add(g);d.add(c);Ti.API.debug("tiver:"+Titanium.version);
null!=Ti.UI.iOS&&0<=compVersions(Titanium.version,"3.1.3")?(h=Ti.UI.iOS.createNavigationWindow({modal:!0,window:d}),h.open()):d.open({modal:!0});d.add(e);k.addEventListener("click",function(){null!=h&&h.close();d.close();a.fireEvent("cancel",{success:!1,error:"The user cancelled.",result:null})});m.addEventListener("click",function(){e.goBack()});e.addEventListener("beforeload",function(){f||d.add(c);g.show()});e.addEventListener("load",function(e){-1===e.url.indexOf(a.authorizeUrl)?(d.remove(c),
g.hide(),d.leftNavButton!==m&&(d.leftNavButton=m)):(d.leftNavButton!==k&&(d.leftNavButton=k),(e=e.source.evalJS("document.getElementById('oauth_pin').getElementsByTagName('code')[0].innerText"))?(f||(null!=h&&h.close(),d.close()),b.accessTokenUrl="https://api.twitter.com/oauth/access_token?oauth_verifier="+e,b.fetchAccessToken(function(){a.fireEvent("login",{success:!0,error:!1,accessTokenKey:b.getAccessTokenKey(),accessTokenSecret:b.getAccessTokenSecret()});a.authorized=!0;f&&(null!=h&&h.close(),
d.close())},function(b){a.fireEvent("login",{success:!1,error:"Failure to fetch access token, please try again.",result:b})})):(d.remove(c),g.hide()))})}var j=function(){},f="android"===Ti.Platform.osname,i=require("jp.coe.mod.jsOAuth-1.3.3"),c=function(a){var b;b=this instanceof c?this:new j;a||(a={});b.windowTitle=a.windowTitle||"Twitter Authorization";b.windowClose=a.windowClose||"Close";b.windowBack=a.windowBack||"Back";b.consumerKey=a.consumerKey;b.consumerSecret=a.consumerSecret;b.authorizeUrl=
"https://api.twitter.com/oauth/authorize";b.accessTokenKey=a.accessTokenKey;b.accessTokenSecret=a.accessTokenSecret;b.authorized=!1;b.listeners={};b.accessTokenKey&&b.accessTokenSecret&&(b.authorized=!0);a.requestTokenUrl=a.requestTokenUrl||"https://api.twitter.com/oauth/request_token";b.oauthClient=i.OAuth(a);return b};j.prototype=c.prototype;c.prototype.authorize=function(){var a=this;this.authorized?setTimeout(function(){a.fireEvent("login",{success:!0,error:!1,accessTokenKey:a.accessTokenKey,
accessTokenSecret:a.accessTokenSecret})},1):(l.call(this),this.oauthClient.fetchRequestToken(function(b){a.webView.url=a.authorizeUrl+b},function(b){a.fireEvent("login",{success:!1,error:"Failure to fetch access token, please try again.",result:b})}))};c.prototype.request=function(a,b,d,e,c){var g=this,f=this.oauthClient,a=a.match(/^https?:\/\/.+/i)?a:"https://api.twitter.com/"+a;f.request({method:e,url:a,data:b,headers:d,success:function(a){c.call(g,{success:!0,error:!1,result:a})},failure:function(a){c.call(g,
{success:!1,error:"Request failed",result:a})}})};c.prototype.logout=function(a){this.oauthClient.setAccessToken("","");this.accessTokenSecret=this.accessTokenKey=null;this.authorized=!1;a()};c.prototype.isAuthorized=function(){return this.authorized};c.prototype.addEventListener=function(a,b){this.listeners=this.listeners||{};this.listeners[a]=this.listeners[a]||[];this.listeners[a].push(b)};c.prototype.fireEvent=function(a,b){for(var d=this.listeners[a]||[],c=0;c<d.length;c++)d[c].call(this,b)};
return c}(this);